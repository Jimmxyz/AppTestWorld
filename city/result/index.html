<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../place/map.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Momo+Trust+Display&display=swap"
      rel="stylesheet"
    />
    <title>Metrop Géo</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  </head>
  <body>
    <style>
      h1 {
        margin-bottom: 12px;
      }
      table {
        border-collapse: collapse;
        margin: 0 auto;
        width: 50vw;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        border-radius: 8px;
        overflow: hidden;
      }
      thead {
        background: #616161;
        color: #fff;
      }
      th,
      td {
        padding: 10px 12px;
        text-align: left;
        border-bottom: 1px solid #eee;
        font-size: 14px;
      }
    </style>
    <h1>Tableau des scores</h1>

    <table id="scoresTable" aria-label="Tableau de scores">
      <thead>
        <tr>
          <th>#</th>
          <th>Mégapole</th>
          <th>Pays</th>
          <th>km</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
    <script>
      const params = new URLSearchParams(window.location.search);
      const returned = params.get("return");
      const learningID = parseInt(params.get("learningID"));
      const jsonName = params.get("json");
      const posi = parseInt(localStorage.getItem(jsonName + "_learn"))
      function back() {
        if(miss / (fail + miss + good) < 0.1 && fail == 0 && posi == learningID){
          localStorage.setItem(jsonName + "_learn",posi+1)
        }
        const params = new URLSearchParams({
          json: jsonName,
        });
        window.location.replace(returned + "/index.html?" + params);
      }
      if (
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches
      ) {
        document.body.style.color = "#ffffff";
        document.body.style.backgroundColor = "#1a1a1aff";
      } else {
        document.body.style.color = "#000000ff";
        document.body.style.backgroundColor = "#ffffffff";
      }

      let miss = 0;
      let fail = 0;
      let good = 0;

      function fill() {
        score = JSON.parse(localStorage.getItem("SCORE"));
        city = JSON.parse(localStorage.getItem("CITY"));
        for (let i = 0; i < city.length; i++) {
          document.getElementById("tbody").innerHTML +=
            '<tr id="tra' + i + '"></tr>';
        }
        for (let i = 0; i < city.length; i++) {
          document.getElementById("tra" + i).innerHTML =
            '<th id="tid' +
            i +
            '">' +
            (i + 1) +
            ".</th>" +
            "<th>" +
            city[i].name +
            "</th>" +
            "<th>" +
            city[i].country +
            "</th>" +
            "<th>" +
            score[i] +
            "</th>";
        }
        for (let i = 0; i < city.length; i++) {
          let color = "";
          if (score[i] < 100) {
            good++;
            color = "43a548";
          } else if (score[i] < 300) {
            miss++;
            color = "f2651f";
          } else {
            fail++;
            color = "e23437";
          }
          document.getElementById("tid" + i).style.backgroundColor =
            "#" + color;
        }
      }
      fill();
    </script>
    <div id="info">
      <br /><br />
      <button class="btn" onclick="back()">Revenir au menu principal</button>
    </div>
  </body>
</html>
